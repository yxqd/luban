#!/usr/bin/env python
#
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
#                                 Jiao Lin
#                      California Institute of Technology
#                      (C) 2006-2009  All Rights Reserved
#
# {LicenseText}
#
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#


from luban.content import select


from luban.components.Actor import Actor as base
class Actor(base):

    class Inventory(base.Inventory):

        import pyre.inventory

        title = pyre.inventory.str('title')
        abstract = pyre.inventory.str('abstract')


    def default(self, director):
        return self.presentForm(director)
    

    def presentForm(self, director):
        from luban.content.Page import Page
        page = Page('test page')
        document = page.document()
        maindoc = document.document(id='maindoc')

        # the form
        form = maindoc.form(id='form1')

        t = form.text(
            label='Title',
            value='',
            name='title',
            size = 80,
            id = 'titleinput',
            )
        
        ta = form.textarea(
            label='Abstract',
            cols=80, rows=20,
            value='',
            name='abstract',
            id = 'abstractinput',
            )
        
        # submit button
        submit = form.submitbutton(label="Update")

        # action when form is submitted
        form.onsubmit = select(element=form).submit(
            actor = 'test-weaver-form-submission',
            routine = 'processForm',
            )
        return page


    def processForm(self, director):
        errors = {}
        
        title = self.inventory.title
        if not title:
            errors['title'] = 'Title cannot be empty'
            
        abstract = self.inventory.abstract
        if not abstract:
            errors['abstract'] = 'Abstract cannot be empty'

        if errors:
            return self.formError(director, errors=errors)

        return self.echo(director)


    def echo(self, director):
        from luban.content.Document import Document
        doc = Document(title='Form is fine')

        title = self.inventory.title
        p = doc.paragraph()
        p.text = ['Title: %s' % title]

        abstract = self.inventory.abstract
        p = doc.paragraph()
        p.text = ['Abstract: %s' % abstract]
        
        from luban.content import select
        return select(id='maindoc').replaceContent(doc)


    def formError(self, director, errors=None):
        from luban.content import select
        return [
            select(id='%sinput' % name).showError(text)
            for name, text in errors.iteritems()
            ]
    
    
    def __init__(self, *args, **kwds):
        super(Actor, self).__init__(*args, **kwds)
        return


    def _init(self):
        super(Actor, self)._init()
        return



def actor():
    return Actor('test-weaver-portletitem-action')


# version
__id__ = "$Id$"

# End of file 
